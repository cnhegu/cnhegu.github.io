# .github/workflows/deploy.yml

name: Deploy Hugo site to GitHub Pages

on:
  push:
    branches:
      - main # ç¡®ä¿è¿™æ˜¯ä½ çš„ä¸»åˆ†æ”¯å
  workflow_dispatch:

# å…³é”®ï¼šä¸ºå·¥ä½œæµè®¾ç½®æƒé™ï¼Œä½¿å…¶å¯ä»¥éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# è®¾ç½®å¹¶å‘æ§åˆ¶ï¼Œç¡®ä¿æ¯æ¬¡åªæœ‰ä¸€ä¸ªéƒ¨ç½²åœ¨è¿è¡Œ
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  # æ„å»ºä»»åŠ¡
  build:
    runs-on: ubuntu-latest
    steps:
      # ç¬¬ 1 æ­¥ï¼šæ£€å‡ºä½ çš„ä»“åº“ä»£ç 
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive
          fetch-depth: 0

      # ç¬¬ 2 æ­¥ï¼šå®‰è£…æœ€æ–°ç‰ˆçš„ Hugo (Extended ç‰ˆæœ¬)
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'
          extended: true

      # ç¬¬ 3 æ­¥ï¼šä¸‹è½½å¹¶æ›´æ–° Hugo æ¨¡å— (åŒ…æ‹¬ä½ çš„ä¸»é¢˜)
      - name: Update Hugo Modules
        run: hugo mod get -u

      # ç¬¬ 4 æ­¥ï¼ˆè°ƒè¯•ç”¨ï¼‰ï¼šæ£€æŸ¥æ–‡ä»¶å†…å®¹
      - name: ğŸ•µï¸ Check Content of _index.md
        run: |
          echo "--- Verifying content of _index.md on the runner ---"
          cat ./content/about/_index.md
          echo "--- End of file content ---"

      # ç¬¬ 5 æ­¥ï¼šæ‰§è¡Œ Hugo æ„å»ºï¼Œå¹¶å¼ºåˆ¶å¿½ç•¥ç¼“å­˜
      - name: Build with Hugo
        run: hugo --minify --ignoreCache # <--- è¿™é‡Œæ˜¯å”¯ä¸€çš„ä¿®æ”¹

      # ç¬¬ 6 æ­¥ï¼šé…ç½® GitHub Pages
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # ç¬¬ 7 æ­¥ï¼šå°†æ„å»ºå¥½çš„ç½‘ç«™ (public ç›®å½•) æ‰“åŒ…æˆæ„ä»¶
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./public

  # éƒ¨ç½²ä»»åŠ¡
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      # ç¬¬ 8 æ­¥ï¼šä»æ„ä»¶éƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4