{{/*
    这是一个自定义的头部模板覆盖文件。
    V5 版本采用更稳健的逻辑，将普通菜单项和特殊功能按钮（如主题切换、搜索）分开渲染，
    以确保所有功能按钮都能在设置开启时正确显示。
*/}}
<header class="header header-flex">
    <div class="header-wrapper">
        <div class="header-inner">
            <div class="site-brand-container">
                <a href="{{ .Site.Home.RelPermalink }}" class="brand">
                    {{ .Site.Title }}
                </a>
            </div>
            <nav class="nav">
                <ul class="menu" id="menu">
                    {{/* 第一步：渲染所有“普通”的菜单项 */}}
                    {{- range .Site.Menus.main -}}
                        {{- if and (ne .Identifier "search") (ne .Identifier "theme-switcher") (ne .Identifier "lang-switcher") -}}
                            <li class="menu-item">
                                <a href="{{ .URL | relLangURL }}" class="menu-item-link" title="{{ .Name }}">
                                    {{ with .Post }}<i class="iconfont icon-{{ . }}"></i>{{ end }}
                                    <span class="menu-item-name">{{ .Name }}</span>
                                </a>
                            </li>
                        {{- end -}}
                    {{- end -}}

                    {{/* 第二步：单独渲染“特殊”的功能按钮 */}}
                    
                    {{/* 主题切换按钮 */}}
                    {{- if .Site.Params.enableDarkMode -}}
                    <li class="menu-item">
                        <a href="javascript:void(0);" class="theme-switch" title="切换主题">
                            <i class="iconfont icon-dark"></i>
                        </a>
                    </li>
                    {{- end -}}

                    {{/* 搜索按钮 */}}
                    <li class="menu-item">
                       {{ partial "search.html" . }}
                    </li>

                </ul>
            </nav>
        </div>
    </div>
    {{/* 移动端导航的“汉堡菜单”按钮 */}}
    {{- if .Site.Params.enableNavToggle -}}
        {{ partial "components/nav-toggle.html" . }}
    {{- end -}}
</header>
